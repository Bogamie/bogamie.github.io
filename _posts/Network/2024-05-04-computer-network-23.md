---
bigtitle: "제4장 네트워크 계층: 데이터 평면"
title: "4.2 라우터 내부에는 무엇이 있을까?"
excerpt: "4.2 라우터 내부에는 무엇이 있을까?"
categories: ['Computer Network']
tags:
  - computer
  - network

toc: true
toc_sticky: true
use_math: true
 
date: 2024-05-04
last_modified_at: 2024-05-04
---

## 1. 라우터 내부의 요소
![image](https://github.com/Bogamie/bogamie.github.io/assets/162293185/c4ff3cbc-e8db-4f3c-9e86-fcd038a08b13){: height="80%" width="80%"}

&nbsp;&nbsp;일반적인 라우터 구조는 그림 4.4와 같다. 라우터의 입력 포트, 출력 포트, 스위치 구조는 거의 항상 하드웨어로 구현된다. 제어 평면 기능은 일반적으로 소프트웨어로 구현되며 라우팅 프로세서에서 실행된다. 입력 포트, 출력 포트, 스위치 구조, 라우팅 프로세서로 라우터의 네 가지 요소를 살펴보자.

<br>

### 입력 포트(input port)


![image](https://github.com/Bogamie/bogamie.github.io/assets/162293185/d8a7e7a1-f13f-4e35-a6ee-c7bd379d682e){: height="80%" width="80%"}

- 포트란 물리적인 입출력 라우터 인터페이스를 의미한다.
- 입력 포트에서 수행되는 검색은 라우터 동작의 핵심이다.
- 입력 링크로 연결되어 있는 다른 호스트의 링크 계층과 상호 운용하기 위해 필요한 링크 계층 기능을 수행한다.
- 라우팅 프로토콜 정보를 전달하는 패킷과 같은 제어 패킷은 입력 포트에서 라우팅 프로세서로 전달된다.

#### 라인 종단

- 물리 계층에서 수행된다.
- 라우터로 들어오는 물리적 링크를 종료하는 물리적 계층 기능을 수행한다.

#### 데이터 링크 처리

- 입력 링크로 연결되어 있는 다른 호스트의 링크 계층과 상호 운용하기 위해 필요한 링크 계층 기능을 수행한다.
  
#### 검색, 포워딩, 큐잉

- 검색 기능을 수행한다. 여기서 포워딩 테이블을 참조하여 도착된 패킷이 스위치 구조를 통해 라우터 출력 포트를 결정한다.

### 출력 포트(output port)

- 스위치 구조에서 수신한 패킷을 저장하고 링크 계층, 물리 계층 기능을 수행하여 출력 링크로 패킷을 전송한다.

### 스위치 구조

- 라우터의 입력 포트와 출력 포트를 연결하는 역할을 한다.

### 라우팅 프로세서

- 라우팅 프로세서는 제어 평면 기능을 수행한다.
- 전통적인 라우터에서는 라우팅 프로토콜을 실행하고 자신에게 연결되어 있는 링크 상태 정보를 유지 관리하며 포워딩 테이블을 계산한다.
- SDN 라우터에서는 원격 컨트롤러와 통신하며 원격 컨트롤러에서 계산된 포워딩 테이블 엔트리를 수신하고 라우터의 입력 포트에 수신한 엔트리를 설치한다.
- 네트워크 관리 기능을 수행한다.

<br>
<br>

## 2. 입력 포트 처리 및 목적지 기반 전송

&nbsp;&nbsp;포워딩 테이블은 라우팅 프로세서에서 계산, 갱신되거나 원격 SDN 컨트롤러에서 수신된다. 이 포워딩 테이블은 라우팅 프로세서에서 입력 라인 카드로 복사된다. 각 라인 카드에서 섀도 복사본을 사용하여 동시에 여러 패킷을 병렬적으로 처리할 수 있게 된다. 따라서 병목 현상을 피할 수 있다.


### 목적지 주소 범위

![image](https://github.com/Bogamie/bogamie.github.io/assets/162293185/56bf87e2-840d-4228-a89f-34fc89cd39e2){: height="80%" width="80%"}

&nbsp;&nbsp;목적지 주소 범위로 포워딩 테이블을 구성할 경우 적은 개수의 엔트리를 갖는 포워딩 테이블을 만들 수 있다.

### 최장 프리픽스 매치 규칙

![image](https://github.com/Bogamie/bogamie.github.io/assets/162293185/fcd85d74-2f4e-4e09-a84d-01bd40ef9ef4){: height="80%" width="80%"}

- 프리픽스란 네트워크 주소의 일부로, 특정 네트워크를 식별하는 데 사용되는 주소의 앞부분이다.

&nbsp;&nbsp;예를 들어 주소 `11001000 00010111 00011000
10101010`의 처음 24비트는 두 번째 엔트리에 매치되고, 주소의 처음 21비트는 테이블에 있는 세 번째 엔트리에 매치된다. 다수의 매치가 있을 때 라우터는 가장 길게 매칭되는 주소의 엔트리를 찾고, 여기에 연관된 링크 인터페이스로 패킷을 보낸다. 이를 최장 프리픽스 매치 규칙이라 한다.

<br>
<br>

## 3. 스위칭

- 패킷이 입력 포트에서 출력 포트로 스위칭(포워딩)되는 구조를 통과하므로 스위치 구조는 라우터의 핵심이다.

![image](https://github.com/Bogamie/bogamie.github.io/assets/162293185/30bb0c8e-ed79-4205-88bc-abbeb866dcc9){: height="80%" width="80%"}

### 메모리를 통한 교환

- CPU(라우팅 프로세서)를 직접 제어해서 입력 포트와 출력 포트 사이에서 패킷을 스위칭한다.
1. 패킷이 도착하면 입력 포트는 라우팅 프로세서에게 인터럽트를 보내 패킷을 프로세서 메모리에 복사한다.
2. 라우팅 프로세서로 목적지 주소를 추출하고 포워딩 테이블에서 출력 포트를 찾은 후 패킷을 출력 포트의 버퍼에 복사한다.

**장점**

- 구현이 비교적 간단하고, 유연성이 높다.

**단점**

- 목적지 포트가 다른 경우에 한 번에 하나의 메모리 읽기/쓰기 작업을 수행할 수 있기 때문에 두 패킷을 동시에 전달할 수 없다.
- 고속 처리에는 적합하지 않고, CPU와 메모리 성능에 크게 의존한다. 

### 버스를 통한 교환

- 라우팅 프로세서의 개입 없이 공유 버스를 통해 직접 출력 포트로 패킷을 전송한다. 입력 포트 메모리에서 출력포트 메모리로 공유 버스를 통해 데이터그램을 전달한다.

**장점**

- 단일 버스를 사용하므로 구조가 간단하고 비용이 적게 든다.

**단점**

- 한번에 하나의 패킷만 버스를 통과할 수 있으므로 그동안 다른 패킷들은 대기해야 한다.
- 모든 패킷이 하나의 버스를 건너가야 하므로, 라우터의 교환 속도는 버스 속도에 의해 제한된다.

### 상호연결 네트워크를 통한 교환

- 공유 버스의 대역폭 제한을 극복하기 위해 좀 더 복잡한 상호연결 네트워크를 사용한다. $N$개의 입력 포트를 $N$개의 출력 포트에 연결하는 $2N$ 버스로 구성된 상호연결 네트워크이다.

**장점**

- 높은 처리 성능과 확장성을 제공한다. 대규모 네트워크 트래픽 처리에 적합하다.

**단점**

- 2개의 패킷이 동일한 출력 포트로 보내지는 경우 한 번에 한번의 패킷만 특정 버스에서 전송될 수 있기 때문에 다른 패킷은 대기해야 한다.
- 구조가 복잡하고 비용이 높으며, 설계가 어려울 수 있다.

<br>
<br>

## 4. 출력 포트 처리

&nbsp;&nbsp;출력 포트 처리는 출력 포트의 메모리에 저장된 패킷을 가져와서 출력 링크를 통해 전송한다. 여기에는 전송을 위한 패킷 선택 및 큐 제거, 필요한 링크 계층 및 물리 계층 전송 기능을 수행하는 것이 포함된다.

<br>
<br>
